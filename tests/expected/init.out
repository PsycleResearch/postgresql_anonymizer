BEGIN;
CREATE EXTENSION IF NOT EXISTS anon CASCADE;
NOTICE:  installing required extension "tsm_system_rows"
NOTICE:  installing required extension "pgcrypto"
SELECT anon.is_initialized() IS FALSE;
 ?column? 
----------
 t
(1 row)

-- basic usage
SELECT anon.init();
 init 
------
 t
(1 row)

SELECT anon.is_initialized();
 is_initialized 
----------------
 t
(1 row)

SELECT anon.reset();
NOTICE:  truncate cascades to table "identifier"
 reset 
-------
 t
(1 row)

-- returns a WARNING and FALSE
SELECT anon.init('./does/not/exists/cd2ks3s/') IS FALSE;
WARNING:  The path './does/not/exists/cd2ks3s/' is not correct. Data is not loaded.
HINT:  Use a relative path within the instance data directory
 ?column? 
----------
 t
(1 row)

SELECT anon.is_initialized() IS FALSE;
 ?column? 
----------
 t
(1 row)

-- load alternate data dir
\! cp -pr data/default $PGDATA/tmp_anon_alternate_data
SELECT anon.init('tmp_anon_alternate_data');
 init 
------
 t
(1 row)

\! rm -fr $PGDATA/tmp_anon_alternate_data
SELECT anon.reset();
NOTICE:  truncate cascades to table "identifier"
 reset 
-------
 t
(1 row)

-- load an empty data dir
-- returns a lot of NOTICE and FALSE
SELECT anon.init('pg_twophase') IS FALSE;
NOTICE:  Data file 'pg_twophase/identifiers_category.csv' is not present. Skipping.
NOTICE:  Data file 'pg_twophase/identifier_fr_FR.csv' is not present. Skipping.
NOTICE:  Data file 'pg_twophase/identifier_en_US.csv' is not present. Skipping.
NOTICE:  Data file 'pg_twophase/city.csv' is not present. Skipping.
NOTICE:  Data file 'pg_twophase/company.csv' is not present. Skipping.
NOTICE:  Data file 'pg_twophase/email.csv' is not present. Skipping.
NOTICE:  Data file 'pg_twophase/first_name.csv' is not present. Skipping.
NOTICE:  Data file 'pg_twophase/iban.csv' is not present. Skipping.
NOTICE:  Data file 'pg_twophase/last_name.csv' is not present. Skipping.
NOTICE:  Data file 'pg_twophase/siret.csv' is not present. Skipping.
NOTICE:  Data file 'pg_twophase/lorem_ipsum.csv' is not present. Skipping.
 ?column? 
----------
 t
(1 row)

SELECT anon.is_initialized() IS FALSE;
 ?column? 
----------
 t
(1 row)

-- backward compatibility with v0.6 and below
SELECT anon.load();
 load 
------
 t
(1 row)

-- Returns a NOTICE and TRUE
SELECT anon.init();
NOTICE:  The anon extension is already initialized.
 init 
------
 t
(1 row)

SELECT anon.is_initialized() IS TRUE;
 ?column? 
----------
 t
(1 row)

SELECT anon.reset();
NOTICE:  truncate cascades to table "identifier"
 reset 
-------
 t
(1 row)

SELECT anon.is_initialized() IS FALSE;
 ?column? 
----------
 t
(1 row)

SELECT anon.start_dynamic_masking( autoload := FALSE );
 start_dynamic_masking 
-----------------------
 t
(1 row)

SELECT anon.is_initialized() IS FALSE;
 ?column? 
----------
 t
(1 row)

ROLLBACK;
